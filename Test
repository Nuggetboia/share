#!/bin/bash

echo "ğŸ” ShareView Connection Tester"
echo "================================"
echo ""

# Check if files exist
echo "ğŸ“ Checking file structure..."
if [ ! -f "server.js" ]; then
    echo "âŒ server.js not found in current directory"
    exit 1
fi

if [ ! -f "package.json" ]; then
    echo "âŒ package.json not found"
    exit 1
fi

if [ ! -d "public" ]; then
    echo "âŒ public/ folder not found - creating it..."
    mkdir public
fi

if [ ! -f "public/index.html" ]; then
    echo "âŒ public/index.html not found"
    echo "   Make sure index.html is INSIDE the public/ folder!"
    exit 1
fi

echo "âœ… All files found"
echo ""

# Check if dependencies are installed
echo "ğŸ“¦ Checking dependencies..."
if [ ! -d "node_modules" ]; then
    echo "âŒ node_modules not found - run 'npm install' first"
    exit 1
fi

echo "âœ… Dependencies installed"
echo ""

# Check if port 3000 is available
echo "ğŸ”Œ Checking if port 3000 is available..."
if lsof -Pi :3000 -sTCP:LISTEN -t >/dev/null ; then
    echo "âš ï¸  Port 3000 is already in use"
    echo "   Kill the process or change the port in server.js"
    echo "   To kill: lsof -ti:3000 | xargs kill -9"
else
    echo "âœ… Port 3000 is available"
fi

echo ""
echo "ğŸ¯ Setup looks good! To start:"
echo "   npm start"
echo ""
echo "ğŸ“ Testing checklist:"
echo "   1. Open http://localhost:3000 in TWO browser tabs"
echo "   2. Tab 1: Continue as Guest â†’ Start Sharing"
echo "   3. Tab 2: Continue as Guest"
echo "   4. Tab 2: Click on Guest's name in 'Sharing Now' list"
echo "   5. You should see Tab 1's screen in Tab 2"
echo ""
echo "ğŸ› If it doesn't work, check browser console (F12)"
echo "   Look for these messages:"
echo "   - 'ğŸ”„ NEW peer connection'"
echo "   - 'ğŸ‰ GOT TRACK: video'"
echo "   - 'ğŸ¥ SHOWING VIDEO NOW'"
echo ""
